%header
  %p.lead Delayed Jobs
  .subnav
    %ul.nav.nav-tabs
      %li.active
        = link_to "All", "#all", "data-toggle" => "tab"
      %li
        = link_to "Failed", "#failed", "data-toggle" => "tab"
      %li
        = link_to "Queued", "#queued", "data-toggle" => "tab"
      %li
        = link_to "Active", "#active", "data-toggle" => "tab"

    .tab-content
      .tab-pane#all.active{ 'data-url'   => all_dj_reports_url }
      .tab-pane#failed{ 'data-url'=> failed_dj_reports_url }
      .tab-pane#active{ 'data-url'=> active_dj_reports_url }
      .tab-pane#queued{ 'data-url'=> queued_dj_reports_url }

%script#dj_reports_template{ :type=> "text/x-handlebars-template" }
  %table.table.table-striped
    %thead
      %tr
        %th
          ID
        %th
          Priority
        %th
          Attempts
        %th
          Queue
        %th
          Last Error
        %th.date
          Failed at
        %th.date
          Run at
        %th.date
          Created at
    %tbody
      {{#.}}
      %tr
        %td
          <a href="#" data-content="<code class='block'>{{payload}}</code>" rel='popover' title='Payload'> {{id}} </a>
        %td
          {{priority}}
        %td
          {{attempts}}
        %td
          {{queue}}
        %td
          <a href="#" data-content="{{last_error}}" rel='modal' title='Last Error'> {{last_error_summary}} </a>
        %td.date
          {{failed_at}}
        %td.date
          {{job.run_at}}
        %td.date
          {{created_at}}
      {{/.}}

%script#last_error_template{ :type=> "text/x-handlebars-template" }
  .modal.hide#last_error_modal
    .modal-header
      %button{ type: "button", class: "close", 'data-dismiss' => "modal" }
        Ã—
      %h3
        Last Error
    .modal-body
      %code
        {{last_error}}
    .modal-footer
      = link_to "Close", '#', class: 'btn btn-primary', 'data-dismiss'=> 'modal'